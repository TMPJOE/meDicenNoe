<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jamboard2</title>
    <link rel="icon" href="B.png" type="image/png">
    <link rel="stylesheet" href="index.css">
</head>
<body>
<div id="root"></div>

<script src="https://unpkg.com/react/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone/babel.min.js"></script>

<script type="text/babel">

class App extends React.Component {
    constructor(props) {
        super(props);
        this.state = { boards: [] };
        this.loadBoards = this.loadBoards.bind(this);
    }

    componentDidMount() {
        this.loadBoards();
    }

    loadBoards() {
        fetch('http://localhost:8080/api/boards')
            .then(response => response.json())
            .then(data => this.setState({ boards: data }))
            .catch(error => console.log('Error al cargar los tableros', error));
    }

    createBoard = (e) => {
        e.preventDefault();
        const owner = e.target.owner.value;
        const name = e.target.name.value;

        fetch('http://localhost:8080/api/boards', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ owner, name })
        })
            .then(response => response.json())
            .then(board => {
                this.loadBoards();
                window.location.href = `./?boardId=${board.id}`;
            })
            .catch(error => console.log('Error al crear el tablero', error));
    };

    render() {
        return (
            <div className="wrapper">
                <nav className="navbar">
                    <div className="navbar-brand">Jamboard</div>
                    <div className="search-container">
                        <input type="text" placeholder="BÃºsqueda" className="search-input" />
                    </div>
                    <div className="navbar-profile">
                        <div className="profile-icon">H</div>
                    </div>
                </nav>
                <div className="boards-list">
                    <h2>Jams Recientes</h2>
                    {this.state.boards.map(board => (
                        <div key={board.id} className="board">
                            <p>Autor: {board.owner}</p>
                            <p>Nombre del Tablero: {board.name}</p>
                            <a href={`./?boardId=${board.id}`} target="_self">Abrir Tablero</a>
                        </div>
                    ))}
                </div>
                <div className="create-board">
                    <h2>Crear Nuevo Tablero</h2>
                    <form onSubmit={this.createBoard}>
                        <label htmlFor="owner">Autor:</label>
                        <input type="text" id="owner" name="owner" required />
                        <label htmlFor="name">Nombre del Tablero:</label>
                        <input type="text" id="name" name="name" required />
                        <button type="submit">Crear</button>
                    </form>
                </div>
            </div>
        );
    }
}

const params = new URLSearchParams(window.location.search);
const boardId = params.get('boardId');

if (boardId) {
    class Board extends React.Component {
        constructor(props) {
            super(props);
            this.state = { board: null };
        }

        componentDidMount() {
            fetch(`http://localhost:8080/api/boards/${boardId}`)
                .then(response => response.json())
                .then(data => this.setState({ board: data }))
                .catch(error => console.log('Error al cargar el tablero', error));
        }

        render() {
            const { board } = this.state;
            return (
                <div className="board-wrapper">
                    {board ? (
                        <div>
                            <h2>Autor: {board.owner}</h2>
                            <h3>Nombre del Tablero: {board.name}</h3>
                            <div id="boardContainer"></div>
                        </div>
                    ) : (
                        <p>Cargando...</p>
                    )}
                </div>
            );
        }
    }

    ReactDOM.render(<Board />, document.getElementById('root'));
} else {
    ReactDOM.render(<App />, document.getElementById('root'));
}

</script>
</body>
</html>
